---
title: "Análisis de los factores que influyen en la decisión de compra de vivienda a nivel internacional"
author: "Ander Castro & Lucas Martinez"
date: "2025-11-06"
output:
  cleanrmd::html_document_clean:
    theme: kacit
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
      smooth_scroll: true
link-citations: true
---

```{r, echo=FALSE, out.width="100%", fig.align="center"}
knitr::include_graphics("./portada.png")
```

# 1. Introducción
La compra de vivienda es uno de los procesos financieros más importantes para los individuos y familias en todo el mundo. Para la mayoría de compradores, esta adquisición se realiza a través de un préstamo hipotecario, por lo que las instituciones financieras evalúan múltiples factores para determinar si un solicitante es elegible para un crédito y bajo qué condiciones.

El mercado inmobiliario global es un sector clave en la economía, moviendo miles de millones de dólares anualmente. La correcta evaluación del perfil financiero del comprador, junto con las características del inmueble, es fundamental tanto para garantizar el acceso a la vivienda como para reducir el riesgo económico de las entidades financieras.

## 1.1 Obtención de los datos
El set de datos fue obtenido de la plataforma Kaggle y contiene información global sobre compras de vivienda y decisiones de aprobación hipotecaria. Incluye 200,000 registros (muestras) con 25 variables relacionadas tanto con la propiedad como con el comprador y su historial financiero.

El objetivo principal de este estudio es realizar un análisis estadístico para comprender qué factores influyen en la aprobación o rechazo de un préstamo hipotecario. Asimismo, se buscará identificar qué características del comprador y de la propiedad tienen mayor peso en la decisión final y desarrollar modelos predictivos que permitan anticipar el resultado de aprobación crediticia.

## 1.2 Metodología

A lo largo de este trabajo, se pretenden analizar las siguientes preguntas:

- *¿Qué variables explican mejor el precio de una vivienda?*
  - ¿Influyen el país, tipo de propiedad, tamaño, número de habitaciones o el estado de
  mobiliario?
  - ¿Qué relación existe entre el precio y variables como el salario del comprador, el
  número de propietarios anteriores o el año de construcción?
  
- *¿Qué factores determinan la decisión de compra (variable decision)?*
  - ¿Qué peso tienen variables como el ratio EMI/income, el nivel de satisfacción
  (satisfaction_score), el rating del vecindario (neighbourhood_rating) o la conectividad
  (connectivity_score)?
  - ¿Se puede predecir la decisión de compra con un modelo de clasificación?
  
- *¿Existen diferencias significativas entre países o ciudades en cuanto a precios y decisiones de compra?*
  - ¿Qué países tienen precios más altos en promedio?
  - ¿Hay diferencias en la tasa de compra (decision = 1) entre regiones?

- *¿Cómo se distribuye el precio de las viviendas y hasta qué punto es posible predecirlo con modelos estadísticos y de machine learning?*
  - ¿Se ajusta a una distribución teórica conocida (gamma, log-normal, normal)?
  - ¿Qué modelo de regresión (lineal, regularizado o de machine learning) ofrece mejor
  rendimiento en la predicción del precio?
  - ¿Qué variables son más relevantes en la estimación?
  
- *¿Qué insights se pueden extraer sobre el perfil del comprador?*
  - ¿Qué relación hay entre salario, gastos mensuales, préstamo y decisión de compra?
  - ¿Influyen los aspectos legales (legal_cases_on_property) o de seguridad
  (crime_cases_reported)?

El análisis se llevará a cabo en dos fases principales:

### **Volumen 1: Análisis Exploratorio y Estadístico**
1. Importación de librerías y datos  
2. Resumen estadístico general 
3. Visualización de datos
4. Contraste de hipótesis y estadística inferencial
5. PCA: Análisis de Componentes Principales  
    - Varianza explicada  
    - Componentes principales

### **Volumen 2: Machine Learning**
6. Modelo para la decisión de compra (clasificación)  
7. Modelo para el precio de la vivienda  
8. Interpretación de resultados
9. Conclusiones y limitaciones
10. Referencias

## 1.3 Variables del dataset
El conjunto de datos **Global House Purchase Decision Dataset** contiene información detallada sobre propiedades residenciales, características del entorno y perfil financiero de los compradores.  
En total, incluye **200.000 observaciones** y **más de 30 variables**, que permiten analizar los factores que influyen en la **decisión de compra** y en la **evaluación crediticia** a nivel internacional.

A continuación, se describen las variables más relevantes incluidas en el dataset:

- `property_id`: Identificador único de cada propiedad.  
- `price`: Precio de la vivienda en dólares estadounidenses (USD).  
- `property_type`: Tipo de propiedad (por ejemplo, *Apartment*, *House*, *Villa*, *Condo*).  
- `furnishing_status`: Nivel de amueblado del inmueble (*Furnished*, *Semi-Furnished*, *Unfurnished*).  
- `property_size_sqft`: Tamaño total de la propiedad en pies cuadrados.  
- `num_bedrooms`: Número de dormitorios de la vivienda.  
- `num_bathrooms`: Número de baños de la vivienda.  
- `num_balconies`: Número de balcones o terrazas (si aplica).  
- `country`: País donde se encuentra la propiedad.  
- `city`: Ciudad en la que está ubicada la vivienda.  
- `zipcode`: Código postal o área geográfica.  
- `crime_cases_reported`: Número de crímenes reportados en la zona (indicador de seguridad).  
- `distance_from_city_center_km`: Distancia desde el centro de la ciudad (en kilómetros).  
- `public_transport_score`: Índice de accesibilidad al transporte público (0–100).  
- `school_quality_score`: Índice de calidad de las escuelas cercanas (0–100).  
- `healthcare_index`: Índice de calidad de los servicios de salud en el área.  
- `environment_quality_score`: Nivel de calidad ambiental y habitabilidad (0–100).  
- `customer_age`: Edad del comprador potencial.  
- `customer_salary`: Salario anual del comprador (en USD).  
- `employment_type`: Tipo de empleo (*Full-time*, *Part-time*, *Self-employed*, etc.).  
- `credit_score`: Puntaje crediticio del comprador (0–850).  
- `loan_amount`: Monto solicitado del préstamo hipotecario.  
- `loan_tenure_years`: Duración del préstamo en años.  
- `monthly_expenses`: Gastos mensuales promedio del comprador.  
- `previous_loans`: Número de préstamos previos registrados.  
- `missed_payments`: Número de pagos atrasados o incumplidos en préstamos anteriores.  
- `marital_status`: Estado civil del comprador (*Single*, *Married*, *Divorced*, etc.).  
- `dependents`: Número de personas dependientes económicamente.  
- `savings_account_balance`: Saldo promedio en cuenta de ahorros.  
- `investment_portfolio_value`: Valor estimado de inversiones del comprador.  
- `house_ownership`: Tipo de tenencia actual (*Rented*, *Owned*, *With Family*).  
- `previous_property_owned`: Número de propiedades poseídas anteriormente.  
- `customer_satisfaction_score`: Puntuación de satisfacción subjetiva del comprador (escala 1–10).  
- `agent_rating`: Calificación promedio del agente inmobiliario (escala 1–5).  
- `approval_time_days`: Tiempo promedio de aprobación del préstamo (en días).  
- `insurance_opted`: Indica si el comprador ha optado por un seguro hipotecario (1 = Sí, 0 = No).  
- `decision`: Variable objetivo binaria: *1 = Compra aprobada / 0 = No compra*.  

En conjunto, estas variables abarcan **dimensiones financieras, demográficas, estructurales y geográficas**, permitiendo un análisis integral del proceso de compra de vivienda a nivel global. Este nivel de detalle facilita la aplicación de técnicas de **análisis estadístico multivariante** y **modelos predictivos**, como regresión logística, PCA y algoritmos de machine learning.


# 2. Análisis exploratorio de los datos

## 2.1 Importar datos y librerías

```{r setup, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(corrplot)
library(scales)
library(broom)
library(car)

data <- read.csv('./global_house_purchase_dataset.csv')
glimpse(data)
```

- ¿Hay valores faltantes? ¿Y duplicados?
```{r}
sum(is.na(data))
sum(duplicated(data))
```

## 2.2 Resumen estadístico general
```{r}
data %>%
  select_if(is.numeric) %>%
  summary()
```
```{r}
sapply(data %>% select(where(is.character)), n_distinct)
```

## 2.3 Visualización de datos

### **Distribución de la variable `decision`**
```{r}
data %>%
  count(decision) %>%
  mutate(pct = n/sum(n)*100,
         decision = factor(decision, labels = c("No compra", "Compra"))) %>%
  ggplot(aes(x = decision, y = pct, fill = decision)) +
  geom_col() +
  geom_text(aes(label = sprintf("%.2f%%", pct)), 
            vjust = 1.5, color = "black", size = 4) +
  labs(title = "Distribución de la decisión de compra",
       x = "Decisión", y = "%") +
  scale_fill_manual(values = c("#F8766D", "#00BA38")) +
  theme_minimal() +
  theme(legend.position = "none")
```
El gráfico representa la distribución porcentual de la variable decision, que indica si un cliente decide o no comprar una vivienda. Se observa un desequilibrio marcado entre ambas categorías: el 76.97% de los individuos no realiza la compra, mientras que solo el 23.03% decide concretarla.

Esta tendencia revela que, dentro del conjunto de datos, la mayoría de los compradores potenciales no llegan a completar la transacción. Este resultado puede reflejar diversos factores, como la falta de capacidad económica, restricciones crediticias, precios elevados o baja percepción de valor respecto a la inversión.

Desde una perspectiva analítica, esta distribución desequilibrada (class imbalance) es un aspecto importante a considerar, ya que puede influir en el rendimiento de los modelos predictivos. Los algoritmos tienden a ajustarse mejor a la clase mayoritaria (“No compra”), lo que podría reducir su capacidad para identificar correctamente los casos en que sí se concreta la compra. En consecuencia, será recomendable aplicar técnicas de balanceo de clases —como sobremuestreo, submuestreo o SMOTE— para mejorar la representatividad del modelo.

En síntesis, la distribución evidencia una tendencia general a la no compra de viviendas dentro del mercado analizado, reforzando la necesidad de explorar en detalle los factores que favorecen o limitan la decisión de compra en los análisis posteriores.
### **Distribución del precio**
```{r}
ggplot(data, aes(x = price)) +
  geom_histogram(fill = "#69b3a2", color = "white", bins = 40) +
  scale_x_continuous(labels = comma) +
  labs(title = "Distribución del precio de las viviendas",
  x = "Precio (USD)", y = "Frecuencia") +
  theme_minimal()
```

El histograma muestra la distribución del precio de las viviendas en dólares estadounidenses (USD). Se observa una distribución asimétrica a la derecha, lo que indica que la mayoría de los inmuebles se concentran en los rangos de precios más bajos, mientras que un número reducido de propiedades presenta precios considerablemente más altos.

La mayor frecuencia de viviendas se sitúa aproximadamente entre los 500,000 y 1,000,000 USD, reflejando que este rango constituye el segmento más representativo del mercado analizado. A partir de valores superiores a los 2 millones de dólares, la frecuencia disminuye progresivamente, mostrando la presencia de casos atípicos o propiedades de lujo que elevan la cola derecha de la distribución.

Este patrón sugiere un mercado inmobiliario heterogéneo, donde predominan las viviendas de precio medio, pero también existe una fracción menor de inmuebles de alto valor. Desde un punto de vista analítico, la asimetría observada justifica la transformación logarítmica del precio (log_price) empleada en el modelo de regresión logística, ya que permite reducir la dispersión, mejorar la normalidad de la variable y facilitar la interpretación de los efectos marginales.

En síntesis, la distribución del precio evidencia un mercado sesgado hacia propiedades de costo medio-bajo, con presencia limitada pero relevante de viviendas de alto valor económico.

```{r}
data <- data %>% mutate(log_price = log(price))

ggplot(data, aes(x = log_price)) +
  geom_histogram(fill = "#69b3a2", color = "white", bins = 40) +
  scale_x_continuous() +
  labs(title = "Distribución del logaritmo del precio de las viviendas",
  x = "Precio (USD)", y = "Frecuencia") +
  theme_minimal()
```
Tras aplicar la transformación logarítmica al precio de las viviendas, se observa que la distribución se aproxima notablemente a una distribución normal, corrigiendo la fuerte asimetría a la derecha presente en los valores originales.

La transformación logra reducir la dispersión de los precios y concentrar la mayoría de los valores en torno a la media, facilitando así la interpretación estadística y el ajuste de modelos que asumen normalidad o linealidad en las relaciones entre variables.

En términos analíticos, este resultado justifica el uso de la variable log_price en el modelo de regresión logística, ya que permite una estimación más estable de los coeficientes y una mejor interpretación de los efectos marginales del precio sobre la decisión de compra.

En síntesis, la transformación logarítmica mejora la simetría y normalidad de la distribución, ofreciendo una representación más adecuada del comportamiento de los precios en el mercado inmobiliario analizado.
### **Distribución del precio por país y por tipo de propiedad**
```{r}
# Boxplot de precios por país
data %>%
  ggplot(aes(x = country, y = price)) +
  geom_boxplot(fill = "#56B4E9", outlier.alpha = 0.2) +
  coord_flip() +
  scale_y_continuous(labels = comma) +
  labs(title = "Distribución del precio por país (Top 10)",
       x = "País", y = "Precio (USD)") +
  theme_minimal()

# Boxplot de precios por tipo de propiedad

data %>%
  ggplot(aes(x = property_type, y = price)) +
  geom_boxplot(fill = "#56B4E9", outlier.alpha = 0.2) +
  scale_y_continuous(labels = comma) +
  coord_flip() +
  labs(title = "Distribución del precio por tipo de propiedad (Top 10)",
       x = "Propiedad", y = "Precio (USD)") +
  theme_minimal()
```
El análisis conjunto de los boxplots de precio por país y precio por tipo de propiedad permite observar una marcada heterogeneidad en el mercado inmobiliario internacional.

En el gráfico de precio por país, se aprecia que Singapur, Emiratos Árabes Unidos (UAE), Japón y Estados Unidos presentan los precios medianos más altos, así como una mayor dispersión, lo que refleja mercados con viviendas de alto valor y mayor desigualdad de precios. En contraste, países como Brasil, India y Sudáfrica muestran precios sustancialmente más bajos y con menor variabilidad, indicando mercados más accesibles y homogéneos.

Por otro lado, el boxplot por tipo de propiedad evidencia diferencias estructurales dentro de cada mercado: las casas independientes suelen tener precios más elevados que los apartamentos o viviendas adosadas, lo que es coherente con su mayor tamaño y nivel de privacidad. Sin embargo, en países con alta densidad urbana —como Singapur o Japón— los apartamentos alcanzan precios comparables o incluso superiores a las viviendas unifamiliares, debido a la limitada disponibilidad de espacio y la alta demanda urbana.

En conjunto, ambos gráficos muestran que el precio de la vivienda está fuertemente condicionado tanto por factores geográficos como por el tipo de propiedad. Los países desarrollados y altamente urbanizados tienden a concentrar los precios más altos, mientras que el tipo de inmueble determina la posición relativa dentro del mercado nacional. Esta comparación refuerza la idea de que el análisis de precios inmobiliarios debe considerar simultáneamente el contexto espacial y estructural de las propiedades.

### **Relaciones entre variables numéricas**
```{r}
# Seleccionar variables numéricas relevantes

num_vars <- data %>%
  select_if(is.numeric) %>%
  select(-property_id)

# Matriz de correlación

corr_matrix <- cor(num_vars)

corrplot(corr_matrix, method = "color", type = "upper", tl.col = "black", order = "hclust")
```
El análisis de las relaciones entre las variables numéricas revela patrones coherentes con el comportamiento esperado en un contexto inmobiliario. 

En primer lugar, se observa una correlación positiva moderada entre el precio de la vivienda y el tamaño del inmueble (`property_size_sqft`), lo cual es lógico, ya que las propiedades de mayor superficie tienden a tener precios más altos.  

Asimismo, variables como el salario del comprador (`customer_salary`) y el monto del préstamo (`loan_amount`) muestran una relación directa con el precio, reflejando que los compradores con mayor capacidad económica tienden a adquirir viviendas más costosas. Este patrón también se relaciona con un mayor puntaje crediticio (`credit_score`), lo que sugiere que las condiciones financieras y la estabilidad del comprador son determinantes en la posibilidad de acceder a propiedades de alto valor.  

Por otro lado, la variable `monthly_expenses` presenta una correlación más débil con el precio o el tamaño de la vivienda, indicando que los gastos mensuales no dependen únicamente del valor del inmueble, sino también de otros factores personales o contextuales.  

En conjunto, las correlaciones entre las variables numéricas refuerzan la existencia de dos dimensiones principales:  
1. Una económica, asociada a los ingresos, crédito y préstamos, que condiciona la capacidad de compra.  
2. Una estructural, vinculada al tamaño y características físicas de la propiedad, que determina su valor en el mercado.  

Estas relaciones justifican el uso de técnicas multivariantes, como el Análisis de Componentes Principales (PCA) y la regresión logística, para sintetizar la información y analizar de forma integrada los factores que influyen en la decisión de compra.

### **Relaciones bivariantes**
```{r}
# Salario vs Decisión de compra
data %>%
  mutate(decision = factor(decision, labels = c("No compra", "Compra"))) %>%
  ggplot(aes(x = decision, y = customer_salary, fill = decision)) +
  geom_boxplot(outlier.alpha = 0.2) +
  scale_fill_manual(values = c("#F8766D", "#00BA38")) +
  labs(title = "Salario según decisión de compra",
  x = "Decisión", y = "Salario del cliente") +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
# Número de crímenes reportados vs Precio medio
data %>%
  group_by(crime_cases_reported) %>%
  summarise(mean_price = mean(price, na.rm = TRUE)) %>%
  ggplot(aes(x = factor(crime_cases_reported), y = mean_price)) +
  geom_col(fill = "#56B4E9") +
  scale_y_continuous(labels = comma) +
  labs(title = "Precio medio según el número de crímenes reportados",
  x = "Número de crímenes", y = "Precio medio (USD)") +
  theme_minimal()
```
El análisis de las relaciones bivariantes permite identificar cómo ciertas variables influyen directamente en la decisión de compra y en el precio de la vivienda.  

En primer lugar, se observa que el salario del cliente (`customer_salary`) presenta una relación positiva con la decisión de compra: los compradores con ingresos más elevados tienden a tener una mayor probabilidad de adquirir una vivienda. Este comportamiento es coherente con la lógica económica, ya que un mayor poder adquisitivo facilita el acceso a la financiación y reduce la percepción de riesgo por parte de las entidades financieras.  

Por otra parte, la relación entre el número de crímenes reportados (`crime_cases_reported`) y el precio medio de las viviendas muestra una tendencia inversa: los precios disminuyen a medida que aumenta la incidencia delictiva. Esto sugiere que la seguridad del entorno es un factor relevante en la valoración del inmueble y en la disposición de compra de los consumidores, reflejando la importancia del contexto urbano y social.  

Estas relaciones refuerzan la idea de que tanto las condiciones económicas personales como los factores contextuales (seguridad y ubicación) influyen significativamente en el comportamiento del comprador y en la dinámica del mercado inmobiliario.  
En conjunto, los resultados evidencian que la decisión de compra no depende únicamente del precio o de las características físicas del inmueble, sino también de variables socioeconómicas y de calidad de vida.

### **Decisión de compra por país**
```{r}
# ¿Qué porcentaje de personas toma la decisión de comprar una vivienda en cada país?
data %>%
  group_by(country) %>%
  summarise(pct_purchase = mean(decision) * 100) %>%
  arrange(desc(pct_purchase)) %>%
  slice_head(n = 10) %>%
  ggplot(aes(x = reorder(country, pct_purchase), y = pct_purchase)) +
  geom_col(fill = "#009E73") +
  geom_text(aes(label = sprintf("%.2f%%", pct_purchase)), 
            hjust = 1.2, color = "white", size = 4) +
  coord_flip() +
  labs(title = "Porcentaje de decisión de compra por país (Top 10)",
  x = "País", y = "% de compras") +
  theme_minimal()
```
El análisis de la decisión de compra por país revela diferencias significativas en el comportamiento de los compradores según su ubicación geográfica.  
Se observa que algunos países presentan una mayor proporción de decisiones de compra positivas, lo que puede estar relacionado con factores como la estabilidad económica, el nivel de ingresos promedio, las condiciones crediticias o las características del mercado inmobiliario local.

Por ejemplo, países con economías desarrolladas y sistemas financieros consolidados muestran tasas de aprobación más elevadas, mientras que en otras regiones con mercados menos accesibles o mayor volatilidad económica, la probabilidad de compra es menor.  

Estas diferencias también pueden reflejar variaciones culturales y regulatorias: en algunos países, la compra de vivienda es vista como una forma de inversión a largo plazo, mientras que en otros predomina el alquiler o el acceso a través de crédito limitado.  

En conjunto, este análisis pone de manifiesto que la ubicación geográfica es un factor determinante en la decisión de compra, integrando tanto aspectos económicos como sociales, y resalta la necesidad de adaptar estrategias comerciales y financieras a las particularidades de cada mercado.


# 3. Contraste de hipótesis y estadística inferencial

En esta sección se pretende verificar estadísticamente algunas de las relaciones sugeridas en el análisis exploratorio previo. Para ello, se formulan hipótesis estadísticas y se aplican pruebas de contraste adecuadas según el tipo de variable y la distribución observada.

## 3.1 Diferencias de precio entre países

Hipótesis:

- H0: El precio medio es igual entre los países.
- H1: Al menos un país presenta un precio medio distinto.

```{r}
# Test de normalidad
shapiro.test(sample(data$log_price, 5000))
```

El test de Shapiro–Wilk, aplicado a una muestra aleatoria de la variable log(price), arrojó un valor de p < 2.2e-16, lo que sugiere que la variable transformada no sigue una distribución normal perfecta. No obstante, dado el gran tamaño muestral, el ANOVA resulta suficientemente robusto frente a desviaciones de normalidad, por lo que la ligera falta de ajuste no compromete la validez del análisis.

A continuación, se realiza la prueba de Levene para ver si las varianzas entre países son homogéneas o no, y esto nos indicará si podemos utilizar el test paramétrico de ANOVA o, en caso contrario, el de Kruskal-Wallis.

```{r}
# Test de homogeneidad de varianzas
leveneTest(log_price ~ factor(country), data = data)
```

El resultado (p = 0.126) sugiere que no existe evidencia suficiente para rechazar la hipótesis nula de igualdad de varianzas, cumpliéndose así el supuesto de homocedasticidad.

Dado que ambos supuestos se consideran satisfechos, se optó por aplicar un ANOVA clásico para comparar los precios medios de las viviendas entre países utilizando la variable transformada log(price). En caso contrario (si las varianzas hubieran sido significativamente distintas), se habría recurrido a la alternativa no paramétrica de Kruskal–Wallis.

```{r}
# ANOVA
anova_country <- aov(log_price ~ factor(country), data = data)
summary(anova_country)
```

El análisis de varianza (ANOVA) realizado sobre el precio de la vivienda en su escala logarítmica revela diferencias estadísticamente significativas entre países. El modelo muestra un valor F = 7414 con un nivel de significancia extremadamente bajo (p < 2e-16), lo que indica que la variación del precio medio de las viviendas difiere de forma sustancial según el país.

En otras palabras, el país constituye un factor determinante en la formación del precio inmobiliario global. Estas diferencias pueden atribuirse a disparidades estructurales entre mercados —como el nivel de desarrollo económico, la demanda habitacional, las políticas crediticias o la regulación del sector— que influyen directamente sobre los precios de las propiedades.

El alto valor del estadístico F refleja que la proporción de variabilidad explicada por el país es muy superior a la variabilidad interna dentro de cada país, reforzando la conclusión de que la localización geográfica es uno de los principales determinantes del valor de la vivienda a escala internacional.

Este test de Tukey incluye una corrección automática del error familiar (FWER), garantizando que la probabilidad de obtener falsos positivos se mantenga controlada al realizar múltiples comparaciones simultáneas.

```{r}
# Post-hoc Tukey
tukey <- TukeyHSD(anova_country)
sum(tukey[["factor(country)"]][, "p adj"]>0.05)
```
El test post-hoc de Tukey, que incorpora una corrección automática del error familiar (FWER) para controlar la probabilidad de falsos positivos en comparaciones múltiples, confirma que todas las diferencias entre los pares de países son estadísticamente significativas (p < 0.05).
Este resultado refuerza la conclusión del ANOVA, indicando que el país de localización influye de manera decisiva en el precio medio de las viviendas, y que no existen grupos de países con precios similares dentro del conjunto analizado.

## 3.2 Factores que influyen en la decisión de compra

```{r}
data$decision <- as.factor(data$decision)

model1 <- glm(decision ~ log_price + factor(country) +
                satisfaction_score + bathrooms + rooms +
                previous_owners, data
              = data, family = binomial)

summary(model1)
```

```{r}
coef_plot <- tidy(model1) %>%
  filter(term != "(Intercept)") %>%
  mutate(signif = ifelse(p.value < 0.05, "*", ""),
         term = paste0(term, signif),
         term = reorder(term, estimate))

ggplot(coef_plot, aes(x = term, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = estimate - std.error, ymax =
                      estimate + std.error),
                width = 0.2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Efecto de las variables en la probabilidad de
       compra",
       x = "Variables", y = "Coeficiente")
```

El modelo de regresión logística muestra que la decisión de compra está influida principalmente por el precio de la vivienda (en su escala logarítmica), el país donde se ubica el inmueble y el nivel de satisfacción del comprador. En particular, se observa que el coeficiente de log_price es negativo y altamente significativo (p < .001), lo que indica que, a medida que el precio aumenta, la probabilidad de que el comprador decida adquirir la vivienda disminuye. Este resultado sugiere que la capacidad económica constituye un factor limitante esencial en la decisión final de compra.

La variable satisfaction_score presenta un efecto positivo y muy significativo (p < .001), implicando que un mayor nivel de satisfacción subjetiva incrementa considerablemente la probabilidad de compra. Este hallazgo pone de relieve el peso de los factores emocionales y de percepción personal, además de los estrictamente financieros, en la decisión de adquisición de una vivienda.

En cuanto al país de residencia, se identifican diferencias significativas entre mercados. Los compradores en Brasil, India, Sudáfrica, Singapur, Emiratos Árabes Unidos y Estados Unidos presentan probabilidades de compra significativamente menores en comparación con el país de referencia (Australia). Estas diferencias sugieren la existencia de factores estructurales, regulatorios y culturales que condicionan la decisión de compra, como políticas de crédito, estabilidad económica o condiciones del mercado inmobiliario local.

Por el contrario, variables relacionadas con las características físicas del inmueble —como el número de baños (bathrooms), de habitaciones (rooms) o de propietarios anteriores (previous_owners)— no muestran efectos estadísticamente significativos cuando se controlan las demás variables del modelo. Esto indica que, en este contexto internacional, las condiciones socioeconómicas del comprador y su satisfacción percibida tienen un peso mayor que las características estructurales de la vivienda en la decisión final de compra.

# 4. PCA: Análisis de Componentes Principales

```{r}
numeric_data <- data %>%
  select(where(is.numeric))

numeric_data <- numeric_data %>%
  select(-any_of(c("property_id", "decision")))

scaled_data <- scale(numeric_data)

pca_result <- prcomp(scaled_data, center = TRUE, scale. = TRUE)
summary(pca_result)

varianza_explicada <- pca_result$sdev^2 / sum(pca_result$sdev^2)
varianza_acumulada <- cumsum(varianza_explicada)

plot(varianza_acumulada,
     type = "b",
     pch = 19,
     col = "#0072B2",
     xlab = "Número de Componentes Principales",
     ylab = "Varianza Explicada Acumulada",
     main = "Varianza explicada por los componentes principales")
abline(h = 0.80, col = "red", lty = 2)








```
El análisis de componentes principales (PCA) ha sido clave para identificar los factores que explican la mayor parte de la variabilidad en el conjunto de datos sobre compras de vivienda a nivel internacional. Los resultados indican que el primer componente principal (PC1) captura una porción significativa de la varianza total, alrededor del 18% al 20%. Además, los primeros diez componentes en conjunto explican cerca del 70–75% de la variabilidad del conjunto de datos.

Desde una perspectiva interpretativa, los componentes principales están principalmente relacionados con variables financieras y estructurales. El PC1 parece estar fuertemente vinculado a factores como el precio de la vivienda, el salario del cliente y el monto del préstamo, lo que sugiere que este eje resume el nivel económico y la capacidad de compra de los compradores. Por otro lado, el PC2 refleja variaciones asociadas a características físicas del inmueble, como el tamaño, el número de habitaciones o la ubicación dentro del país.

El gráfico que muestra la varianza explicada revela un punto de inflexión a partir del octavo componente, lo que sugiere que los primeros componentes concentran la mayor parte de la información relevante. Esto podría ser útil para simplificar el análisis o para alimentar modelos predictivos posteriores, como los de aprobación hipotecaria o decisiones de compra.

En resumen, el PCA demuestra que gran parte de la variabilidad en el mercado inmobiliario internacional puede explicarse a partir de un grupo reducido de factores económicos y estructurales, confirmando que los aspectos financieros del comprador y el valor del inmueble son los elementos más determinantes en la dinámica global de compra de vivienda.
