---
title: "Análisis de los factores que influyen en la decisión de compra de vivienda a nivel internacional"
author: "Ander Castro & Lucas Martinez"
date: "2025-11-06"
output:
  cleanrmd::html_document_clean:
    theme: kacit
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
      smooth_scroll: true
link-citations: true
---

```{r, echo=FALSE, out.width="100%", fig.align="center"}
knitr::include_graphics("./portada.png")
```

# 1. Introducción
La compra de vivienda es uno de los procesos financieros más importantes para los individuos y familias en todo el mundo. Para la mayoría de compradores, esta adquisición se realiza a través de un préstamo hipotecario, por lo que las instituciones financieras evalúan múltiples factores para determinar si un solicitante es elegible para un crédito y bajo qué condiciones.

El mercado inmobiliario global es un sector clave en la economía, moviendo miles de millones de dólares anualmente. La correcta evaluación del perfil financiero del comprador, junto con las características del inmueble, es fundamental tanto para garantizar el acceso a la vivienda como para reducir el riesgo económico de las entidades financieras.

## 1.1 Obtención de los datos
El set de datos fue obtenido de la plataforma Kaggle y contiene información global sobre compras de vivienda y decisiones de aprobación hipotecaria. Incluye 200,000 registros (muestras) con 25 variables relacionadas tanto con la propiedad como con el comprador y su historial financiero.

El objetivo principal de este estudio es realizar un análisis estadístico para comprender qué factores influyen en la aprobación o rechazo de un préstamo hipotecario. Asimismo, se buscará identificar qué características del comprador y de la propiedad tienen mayor peso en la decisión final y desarrollar modelos predictivos que permitan anticipar el resultado de aprobación crediticia.

## 1.2 Metodología

A lo largo de este trabajo, se pretenden analizar las siguientes preguntas:

- *¿Qué variables explican mejor el precio de una vivienda?*
  - ¿Influyen el país, tipo de propiedad, tamaño, número de habitaciones o el estado de
  mobiliario?
  - ¿Qué relación existe entre el precio y variables como el salario del comprador, el
  número de propietarios anteriores o el año de construcción?
  
- *¿Qué factores determinan la decisión de compra (variable decision)?*
  - ¿Qué peso tienen variables como el ratio EMI/income, el nivel de satisfacción
  (satisfaction_score), el rating del vecindario (neighbourhood_rating) o la conectividad
  (connectivity_score)?
  - ¿Se puede predecir la decisión de compra con un modelo de clasificación?
  
- *¿Existen diferencias significativas entre países o ciudades en cuanto a precios y decisiones de compra?*
  - ¿Qué países tienen precios más altos en promedio?
  - ¿Hay diferencias en la tasa de compra (decision = 1) entre regiones?

- *¿Cómo se distribuye el precio de las viviendas y hasta qué punto es posible predecirlo con modelos estadísticos y de machine learning?*
  - ¿Se ajusta a una distribución teórica conocida (gamma, log-normal, normal)?
  - ¿Qué modelo de regresión (lineal, regularizado o de machine learning) ofrece mejor
  rendimiento en la predicción del precio?
  - ¿Qué variables son más relevantes en la estimación?
  
- *¿Qué insights se pueden extraer sobre el perfil del comprador?*
  - ¿Qué relación hay entre salario, gastos mensuales, préstamo y decisión de compra?
  - ¿Influyen los aspectos legales (legal_cases_on_property) o de seguridad
  (crime_cases_reported)?

El análisis se llevará a cabo en dos fases principales:

### Volumen 1: Análisis Exploratorio y Estadístico
1. Importación de librerías y datos  
2. Limpieza y preprocesamiento  
3. Visualización de datos
4. Contraste de hipótesis y estadística inferencial
5. PCA: Análisis de Componentes Principales  
    - Varianza explicada  
    - Componentes principales

### Volumen 2: Machine Learning
6. Modelo para la decisión de compra (clasificación)  
7. Modelo para el precio de la vivienda  
8. Interpretación de resultados
9. Conclusiones y limitaciones
10. Referencias  

## 1.3 Variables del dataset
El dataset incluye 200,000 registros con información sobre propiedades y compradores.
En total hay 25 variables, pero a continuación se presentan las variables más relevantes:

  - `price`: Precio de la vivienda
  - `property_type`, `furnishing_status`: Tipo y nivel de amueblado        
  - `property_size_sqft`: Tamaño del inmueble              
  - `country`, `city`: Ubicación geográfica             
  - `customer_salary`: Salario anual del comprador      
  - `credit_score`: Puntaje crediticio               
  - `loan_amount`, `loan_tenure_years`: Monto y duración del préstamo    
  - `monthly_expenses`: Gastos mensuales                 
  - `previous_loans`, `missed_payments`: Historial financiero             
  - `crime_cases_reported`: Seguridad del entorno            
  - `decision`: 1 = Compra aprobada, 0 = No compra


# 2. Análisis exploratorio de los datos

## 2.1 Importar datos y librerías

```{r setup, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(corrplot)

data <- read.csv('./global_house_purchase_dataset.csv')
glimpse(data)
```

- ¿Hay valores faltantes?
```{r}
sum(is.na(data))
```

## 2.2 Resumen estadístico general
```{r}
data %>%
  select_if(is.numeric) %>%
  summary()
```

## 2.3 Distribución del precio
```{r}
ggplot(data, aes(x = price)) +
  geom_histogram(fill = "#69b3a2", color = "white", bins = 40) +
  scale_x_continuous() +
  labs(title = "Distribución del precio de las viviendas",
  x = "Precio (USD)", y = "Frecuencia") +
  theme_minimal()
```

## 2.4 Precio medio por país y tipo de propiedad
```{r}
# Precio medio por país (mostrando los 10 con más observaciones)
top_countries <- data %>%
    count(country, sort = TRUE) %>%
    slice_head(n = 10) %>%
    pull(country)

data %>%
    filter(country %in% top_countries) %>%
    group_by(country) %>%
    summarise(mean_price = mean(price, na.rm = TRUE)) %>%
    ggplot(aes(x = reorder(country, mean_price), y = mean_price)) +
    geom_col(fill = "#0072B2") +
    coord_flip() +
    scale_y_continuous() +
    labs(title = "Precio medio por país",
         x = "País", y = "Precio medio (USD)") +
    theme_minimal()

# Precio medio por tipo de propiedad

data %>%
  group_by(property_type) %>%
  summarise(mean_price = mean(price, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(property_type, mean_price), y = mean_price)) +
  geom_col(fill = "#E69F00") +
  coord_flip() +
  scale_y_continuous() +
  labs(title = "Precio medio por tipo de propiedad",
  x = "Tipo de propiedad", y = "Precio medio (USD)") +
  theme_minimal()
```

## 2.5 Relaciones entre variables numéricas
```{r}
# Seleccionar variables numéricas relevantes

num_vars <- data %>%
  select_if(is.numeric) %>%
  select(-property_id)

# Matriz de correlación

corr_matrix <- cor(num_vars)

corrplot(corr_matrix, method = "color", type = "upper", tl.col = "black", order = "hclust")
```

## 2.6 Relaciones bivariantes
```{r}
# Salario del cliente vs Decisión de compra
data %>%
  mutate(decision = factor(decision, labels = c("No compra", "Compra"))) %>%
  ggplot(aes(x = decision, y = customer_salary, fill = decision)) +
  geom_boxplot(outlier.alpha = 0.2) +
  scale_y_continuous() +
  scale_fill_manual(values = c("#F8766D", "#00BA38")) +
  labs(title = "Salario del cliente según decisión de compra",
  x = "Decisión", y = "Salario del cliente") +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
# Número de crímenes reportados vs Precio medio
data %>%
  group_by(crime_cases_reported) %>%
  summarise(mean_price = mean(price, na.rm = TRUE)) %>%
  ggplot(aes(x = factor(crime_cases_reported), y = mean_price)) +
  geom_col(fill = "#56B4E9") +
  scale_y_continuous() +
  labs(title = "Precio medio según el número de crímenes reportados",
  x = "Número de crímenes", y = "Precio medio (USD)") +
  theme_minimal()
```

## 2.7 Decisión de compra por país
```{r}
# ¿Qué porcentaje de personas toma la decisión de comprar una vivienda en cada país?
data %>%
  group_by(country) %>%
  summarise(pct_purchase = mean(decision) * 100) %>%
  arrange(desc(pct_purchase)) %>%
  slice_head(n = 10) %>%
  ggplot(aes(x = reorder(country, pct_purchase), y = pct_purchase)) +
  geom_col(fill = "#009E73") +
  coord_flip() +
  labs(title = "Porcentaje de decisión de compra por país (Top 10)",
  x = "País", y = "% de compras") +
  theme_minimal()
```
